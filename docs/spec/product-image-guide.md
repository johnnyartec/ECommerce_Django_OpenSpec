# å•†å“åœ–ç‰‡ä¸Šå‚³åŠŸèƒ½ä½¿ç”¨æŒ‡å—

## åŠŸèƒ½æ¦‚è¿°

å•†å“åœ–ç‰‡ç®¡ç†åŠŸèƒ½å…è¨±ç®¡ç†å“¡ç‚ºæ¯å€‹å•†å“ä¸Šå‚³å¤šå¼µåœ–ç‰‡ï¼Œç³»çµ±æœƒè‡ªå‹•ç”¢ç”Ÿç¸®åœ–ä¸¦ç®¡ç†æª”æ¡ˆå„²å­˜ã€‚

## å¿«é€Ÿé–‹å§‹

### 1. åœ¨ Admin å¾Œå°ä¸Šå‚³åœ–ç‰‡

1. ç™»å…¥ Django Admin å¾Œå° (`/admin/`)
2. é€²å…¥ã€Œå•†å“ã€åˆ—è¡¨ä¸¦é¸æ“‡ä¸€å€‹å•†å“ï¼ˆæˆ–æ–°å»ºå•†å“å¾Œå„²å­˜ï¼‰
3. åœ¨å•†å“ç·¨è¼¯é é¢ä¸‹æ–¹æœƒçœ‹åˆ°ã€Œå•†å“åœ–ç‰‡ã€å€å¡Š
4. é»æ“Šã€Œé¸æ“‡æª”æ¡ˆã€ä¸Šå‚³åœ–ç‰‡
5. å¯é¸å¡«ï¼š
   - **ä¸»åœ–**ï¼šå‹¾é¸è¨­ç‚ºå•†å“ä¸»åœ–
   - **é¡¯ç¤ºé †åº**ï¼šæ•¸å­—è¶Šå°æ’è¶Šå‰é¢
   - **æ›¿ä»£æ–‡å­—**ï¼šæä¾›åœ–ç‰‡æè¿°ï¼ˆSEO å‹å–„ï¼‰
6. é»æ“Šã€Œå„²å­˜ã€

> ğŸ’¡ **æç¤º**ï¼šæ–°å»ºå•†å“æ™‚éœ€è¦å…ˆå„²å­˜ä¸€æ¬¡ï¼Œæ‰èƒ½ä¸Šå‚³åœ–ç‰‡ã€‚

### 2. åœ–ç‰‡æ ¼å¼èˆ‡é™åˆ¶

| é …ç›®     | é™åˆ¶                  |
| -------- | --------------------- |
| å…è¨±æ ¼å¼ | JPG, JPEG, PNG, WEBP  |
| æª”æ¡ˆå¤§å° | æœ€å¤§ 5MB              |
| åœ–ç‰‡å°ºå¯¸ | æœ€å¤§ 4000 x 4000 åƒç´  |

### 3. è‡ªå‹•ç”¢ç”Ÿçš„ç¸®åœ–

ç³»çµ±æœƒè‡ªå‹•ç”¢ç”Ÿå…©ç¨®ç¸®åœ–ï¼š

- **150x150**ï¼šæ­£æ–¹å½¢ç¸®åœ–ï¼Œç”¨æ–¼åˆ—è¡¨é è¦½
- **800x800**ï¼šä¸­ç­‰å°ºå¯¸ç¸®åœ–ï¼Œä¿æŒåŸå§‹æ¯”ä¾‹

ç¸®åœ–å„²å­˜ä½ç½®ï¼š`media/products/<å•†å“ID>/thumbs/`

## ä¸»åœ–åŠŸèƒ½

### è¨­å®šä¸»åœ–

1. åœ¨å•†å“åœ–ç‰‡ inline ä¸­å‹¾é¸ã€Œä¸»åœ–ã€æ¬„ä½
2. å„²å­˜å¾Œï¼Œè©²åœ–ç‰‡æœƒè‡ªå‹•æˆç‚ºå•†å“çš„ä¸»è¦å±•ç¤ºåœ–ç‰‡
3. åŒä¸€å•†å“åªèƒ½æœ‰ä¸€å¼µä¸»åœ–ï¼Œè¨­å®šæ–°ä¸»åœ–æ™‚æœƒè‡ªå‹•å–æ¶ˆèˆŠä¸»åœ–

### åœ¨åˆ—è¡¨é é¡¯ç¤ºä¸»åœ–

å•†å“åˆ—è¡¨é æœƒè‡ªå‹•é¡¯ç¤ºä¸»åœ–çš„ 150x150 ç¸®åœ–ã€‚è‹¥å•†å“æ²’æœ‰åœ–ç‰‡ï¼Œæœƒé¡¯ç¤ºã€Œç„¡åœ–ç‰‡ã€æ–‡å­—ã€‚

## åœ–ç‰‡æ’åº

ä½¿ç”¨ `displayOrder` æ¬„ä½æ§åˆ¶åœ–ç‰‡é¡¯ç¤ºé †åºï¼š

- æ•¸å­—è¶Šå°ï¼Œæ’åºè¶Šå‰é¢
- é è¨­å€¼ç‚º 0
- ä¸»åœ–æœƒå„ªå…ˆé¡¯ç¤º

## æª”æ¡ˆå„²å­˜çµæ§‹

```
media/
â””â”€â”€ products/
    â””â”€â”€ <å•†å“ID>/
        â”œâ”€â”€ <uuid>_<åŸå§‹æª”å>.jpg       # åŸå§‹åœ–ç‰‡
        â””â”€â”€ thumbs/
            â”œâ”€â”€ <uuid>_xxx_150x150.jpg  # æ­£æ–¹å½¢ç¸®åœ–
            â””â”€â”€ <uuid>_xxx_800x800.jpg  # ä¸­ç­‰ç¸®åœ–
```

## æª”æ¡ˆæ¸…ç†æ©Ÿåˆ¶

ç³»çµ±æœƒè‡ªå‹•ç®¡ç†æª”æ¡ˆæ¸…ç†ï¼š

### åˆªé™¤å–®å¼µåœ–ç‰‡

åˆªé™¤ ProductImage ç‰©ä»¶æ™‚ï¼ŒæœƒåŒæ™‚åˆªé™¤ï¼š

- åŸå§‹åœ–ç‰‡æª”æ¡ˆ
- 150x150 ç¸®åœ–
- 800x800 ç¸®åœ–
- ç©ºçš„ç›®éŒ„

### åˆªé™¤å•†å“

åˆªé™¤ Product æ™‚ï¼Œæœƒç´šè¯åˆªé™¤ï¼š

- æ‰€æœ‰ç›¸é—œçš„ ProductImage è¨˜éŒ„
- æ‰€æœ‰åœ–ç‰‡æª”æ¡ˆå’Œç¸®åœ–
- è©²å•†å“çš„åœ–ç‰‡ç›®éŒ„

## å®‰å…¨æ€§

### å·²å¯¦ä½œçš„å®‰å…¨æªæ–½

1. **æª”æ¡ˆé¡å‹é©—è­‰**ï¼šä½¿ç”¨ Pillow é©—è­‰åœ–ç‰‡çœŸå¯¦æ ¼å¼ï¼Œé˜²æ­¢å‰¯æª”åå½è£æ”»æ“Š
2. **æª”æ¡ˆå¤§å°é™åˆ¶**ï¼šé™åˆ¶æœ€å¤§ 5MBï¼Œé˜²æ­¢ DoS æ”»æ“Š
3. **åœ–ç‰‡å°ºå¯¸é™åˆ¶**ï¼šé™åˆ¶æœ€å¤§ 4000x4000 åƒç´ 
4. **UUID æª”æ¡ˆåç¨±**ï¼šä½¿ç”¨ UUID ç”¢ç”Ÿå”¯ä¸€æª”æ¡ˆåï¼Œé¿å…æª”æ¡ˆè¦†è“‹
5. **Admin æ¬Šé™**ï¼šåƒ…æˆæ¬Šç®¡ç†å“¡å¯æ“ä½œ

### ç”Ÿç”¢ç’°å¢ƒæ³¨æ„äº‹é …

1. **åª’é«”æª”æ¡ˆæœå‹™**ï¼šä½¿ç”¨ Nginx æˆ– CDN æœå‹™åª’é«”æª”æ¡ˆ
2. **å„²å­˜ç©ºé–“**ï¼šè€ƒæ…®ä½¿ç”¨é›²ç«¯å„²å­˜ï¼ˆå¦‚ AWS S3ï¼‰
3. **.gitignore**ï¼šç¢ºä¿ `media/` ç›®éŒ„ä¸è¢«æäº¤åˆ°ç‰ˆæœ¬æ§åˆ¶

## ç¨‹å¼ç¯„ä¾‹

### é€éç¨‹å¼ç¢¼ä¸Šå‚³åœ–ç‰‡

```python
from django.core.files.uploadedfile import SimpleUploadedFile
from todolist_app.models import Product, ProductImage

# å–å¾—æˆ–å»ºç«‹å•†å“
product = Product.objects.get(id=1)

# æº–å‚™åœ–ç‰‡æª”æ¡ˆ
with open('path/to/image.jpg', 'rb') as f:
    image_file = SimpleUploadedFile(
        name='product_photo.jpg',
        content=f.read(),
        content_type='image/jpeg'
    )

# å»ºç«‹ ProductImage
product_image = ProductImage.objects.create(
    product=product,
    image=image_file,
    isPrimary=True,
    displayOrder=1,
    altText='å•†å“å±•ç¤ºåœ–'
)

# ç¸®åœ–æœƒè‡ªå‹•ç”¢ç”Ÿ
print(product_image.thumbnail150.url)  # 150x150 ç¸®åœ– URL
print(product_image.thumbnail800.url)  # 800x800 ç¸®åœ– URL
```

### å–å¾—å•†å“çš„ä¸»åœ–

```python
# å–å¾—ä¸»åœ–
primary_image = product.images.filter(isPrimary=True).first()

if primary_image:
    print(primary_image.thumbnail150.url)
else:
    print('å•†å“æ²’æœ‰ä¸»åœ–')
```

### å–å¾—å•†å“çš„æ‰€æœ‰åœ–ç‰‡ï¼ˆä¾æ’åºï¼‰

```python
# ä¾ displayOrder æ’åº
images = product.images.order_by('displayOrder', 'uploadedAt')

for img in images:
    print(f"é †åº {img.displayOrder}: {img.image.url}")
```

## æ¸¬è©¦

åŸ·è¡Œå•†å“åœ–ç‰‡ç›¸é—œæ¸¬è©¦ï¼š

```powershell
# åŸ·è¡Œæ‰€æœ‰ ProductImage æ¸¬è©¦
python manage.py test todolist_app.tests.test_product.ProductImageModelTest -v 2

# åŸ·è¡Œåˆªé™¤æ¸¬è©¦
python manage.py test todolist_app.tests.test_product_image_deletion -v 2

# åŸ·è¡Œ Admin æ¸¬è©¦
python manage.py test todolist_app.tests.test_product.ProductImageAdminTest -v 2

# åŸ·è¡Œæ•´åˆæ¸¬è©¦
python manage.py test todolist_app.tests.test_product.ProductImageIntegrationTest -v 2
```

## å¸¸è¦‹å•é¡Œ

### Q: ç‚ºä»€éº¼æ–°å»ºå•†å“æ™‚çœ‹ä¸åˆ°åœ–ç‰‡ä¸Šå‚³å€å¡Šï¼Ÿ

A: Django Admin çš„ inline åŠŸèƒ½éœ€è¦çˆ¶ç‰©ä»¶å…ˆå­˜åœ¨ã€‚è«‹å…ˆå„²å­˜å•†å“å¾Œï¼Œå†é‡æ–°ç·¨è¼¯å³å¯çœ‹åˆ°åœ–ç‰‡ä¸Šå‚³å€å¡Šã€‚

### Q: ä¸Šå‚³åœ–ç‰‡å¾Œçœ‹ä¸åˆ°ç¸®åœ–é è¦½ï¼Ÿ

A: è«‹ç¢ºèªï¼š

1. å·²å„²å­˜å•†å“ï¼ˆç¸®åœ–åœ¨å„²å­˜æ™‚ç”¢ç”Ÿï¼‰
2. `MEDIA_URL` å’Œ `MEDIA_ROOT` è¨­å®šæ­£ç¢º
3. é–‹ç™¼ç’°å¢ƒå·²å•Ÿç”¨åª’é«”æª”æ¡ˆæœå‹™

### Q: åˆªé™¤å•†å“å¾Œæª”æ¡ˆé‚„å­˜åœ¨ï¼Ÿ

A: ç³»çµ±ä½¿ç”¨ Django signals è™•ç†æª”æ¡ˆæ¸…ç†ã€‚å¦‚æœä½¿ç”¨ `QuerySet.delete()` æ‰¹æ¬¡åˆªé™¤ï¼Œå¯èƒ½ä¸æœƒè§¸ç™¼ signalã€‚å»ºè­°ä½¿ç”¨è¿´åœˆé€ä¸€åˆªé™¤æˆ–ä½¿ç”¨è‡ªè¨‚ç®¡ç†æŒ‡ä»¤æ¸…ç†ã€‚

### Q: åœ–ç‰‡å¤ªå¤§ç„¡æ³•ä¸Šå‚³ï¼Ÿ

A: æª¢æŸ¥ `config/settings.py` ä¸­çš„è¨­å®šï¼š

```python
FILE_UPLOAD_MAX_MEMORY_SIZE = 5242880  # 5MB
```

å¦‚éœ€èª¿æ•´é™åˆ¶ï¼Œä¹Ÿè¦ä¿®æ”¹æ¨¡å‹ä¸­çš„ `clean()` æ–¹æ³•ã€‚

## ç›¸é—œæ–‡ä»¶

- [å•†å“ç®¡ç†è¦æ ¼](../../openspec/changes/add-product-image-upload/specs/product-image-management/spec.md)
- [è¨­è¨ˆæ–‡ä»¶](../../openspec/changes/add-product-image-upload/design.md)
- [ä»»å‹™æ¸…å–®](../../openspec/changes/add-product-image-upload/tasks.md)
